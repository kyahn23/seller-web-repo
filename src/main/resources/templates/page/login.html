<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/full-page">

<!-- login 고유 css -->
<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/cmmn/login.css}">
    <style>
        .etcLink {
            width: 103% !important;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        /* 탭메뉴(line) */
        .tbMenuSub {
            height: 38px;
            border-bottom: 1px solid #0099e8;
        }

        .tbMenuSub>li {
            float: left;
            height: 37px;
            border: solid #dddddd;
            border-width: 1px 1px 0 0;
            background: #f5f5f5;
            border-radius: 3px 3px 0 0
        }

        .tbMenuSub li:first-child {
            border-left: 1px solid #dddddd;
        }

        .tbMenuSub li:first-child.on {
            margin-left: 0
        }

        .tbMenuSub>li>a {
            display: block;
            padding: 3px 15px 0;
            color: #555;
            font-size: 16px;
            line-height: 2;
            font-weight: bold;
            cursor: pointer;
        }

        .tbMenuSub li.on {
            height: 38px;
            background: #fff;
            border-color: #0099e8;
            border-left: 1px solid #0099e8;
            margin: 0 0 0 -1px;
        }

        .tbMenuSub li.on a {
            color: #0099e8;
            padding-bottom: 4px;
            background: #fff;
            border-radius: 3px 3px 0 0
        }

        .tbMenuSub li.on+li {
            border-width: 1px 1px 0 0;
        }

        .tab_content {
            height: 717px;
        }

        /* 탭내용 */
        .tbMenuSubContent {
            display: none;
        }

        .tbMenuSubContent .tblWrapper {
            height: 130px;
        }

        .tbMenuSubContent.on {
            display: block;
        }

        .addMemberInfo {
            padding-top: 10px;
        }

        .addMemberInfo .listDot>li {
            color: #777;
            list-style: none;
            background-image: none;
            padding-left: 0;
        }

        .addMemberInfo .listDot>li b {
            color: #333;
        }

        .addMemberInfo .listDot.colorRed>li {
            color: #e74b3e;
        }

        .colorRed a {
            color: #e74b3e !important;
        }
    </style>
</th:block>

<!-- login 고유 js -->
<th:block layout:fragment="js">
    <script type="text/javascript" th:src="@{/js/lib/CryptoJS/3.1.2/rollups/sha256.js}"></script>
</th:block>

<div layout:fragment="content">
    <div class="loginWrapper">
        <div class="loginVisual">
            <div class="visualBox">
                <h1 class="logo"><img th:src="@{/images/cmmn/logo.png}" alt="PentaWorks"></h1>
                <div class=" vImg"><img th:src="@{/images/cmmn/login-img.png}" alt="로그인이미지">
                </div>
            </div>
        </div>
        <div class="loginBox">
            <div class="loginForm">
                <h2><img th:src="@{/images/cmmn/login-tit.png}" alt="로그인"></h2>
                <fieldset>
                    <legend>로그인</legend>
                    <div class="formWrapper">
                        <form th:action="@{/loginProc}" name="loginPostForm" method="post" autocomplete="off">
                            <p class="txtID">
                                <label for="userId">아이디</label>
                                <input type="text" id="userId" name="userId" placeholder="ID(이메일)">
                            </p>
                            <p class="txtPW">
                                <label for="inputPw">비밀번호</label>
                                <input type="password" id="inputPw" name="inputPw" placeholder="Password">
                                <input type="hidden" id="userPw" name="userPw">
                            </p>
                            <a href="#;" class="btnLogin" id="btnLogin"><span><img th:src="@{/images/cmmn/login-btn.png}" alt="로그인"></span></a>
                        </form>
                    </div>
                </fieldset>
                <div style="height: 10px;"></div>
                <div class="etcLink">
                    <a th:href="@{/join}">회원가입</a>
                    <a href="#popLayerIDPW" class="linkIdpw popLayerIDPW_open">비밀번호 찾기</a>
                </div>
            </div>
        </div>
        <div class="loginFooter">
            <p>copyrights PENTAS. all rights reserved.</p>
        </div>
    </div>
</div>

<div layout:fragment="layer">
    <!-- 팝업: 비밀번호 찾기 -->
    <div class="layerWrapper layerSizeML" id="popLayerIDPW" style="display:inline-block !important">
        <div class="layerHeader">
            <strong>비밀번호 찾기</strong>
            <a href="#" class="btnClose popLayerIDPW_close"><img th:src="@{/images/cmmn/btn-layer-close.png}" alt="창닫기"></a>
        </div>
        <div class="layerContainer">
            <div class="layerContent">
                <!-- 컨텐츠 -->
                <div class="guidanceWrapper">
                    <div class="tabToggleWrap">
                        <!-- Tab Menu -->
                        <ul class="tbMenuSub">
                            <li class="on" data-target="rep"><a><span>대표 회원</span></a></li>
                            <li data-target="emp"><a><span>직원 회원</span></a></li>
                        </ul>

                        <!-- Tab1 -->
                        <div class="tbMenuSubContent on" id="tab_rep">
                            <h3 class="tts">대표 회원</h3>

                            <div class="tblWrapper resetPW">
                                <!-- <h3>대표 회원 내용</h3> -->
                                <div style="height: 20px;"></div>
                                <table class="tblDataRow">
                                    <caption>대표 회원 비밀번호 변경</caption>
                                    <colgroup>
                                        <col style="width:35%">
                                        <col style="width:65%">
                                    </colgroup>
                                    <tbody>
                                    <tr>
                                        <th scope="row"><label for="repNum">사업자 등록번호<span class="icoMust"><em>필수</em></span></label>
                                        </th>
                                        <td>
                                            <input
                                                type="text"
                                                id="repNum"
                                                placeholder="'-'없이 숫자 10자리 입력"
                                                autocomplete="off"
                                                v-mask="'###-##-#####'"
                                                v-model="bnRegNo"
                                            >
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><label for="repName">대표명<span class="icoMust"><em>필수</em></span></label>
                                        </th>
                                        <td>
                                            <input
                                                type="text"
                                                id="repName"
                                                placeholder="대표명을 입력해주세요"
                                                autocomplete="off"
                                                :value="ownerNm"
                                                @input="ownerNm = $event.target.value"
                                            >
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><label for="repEmail">이메일<span class="icoMust"><em>필수</em></span></label>
                                        </th>
                                        <td>
                                            <input
                                                type="text"
                                                id="repEmail"
                                                placeholder="이메일을 입력하세요"
                                                autocomplete="off"
                                                v-model="mstMbrId"
                                            >
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="addMemberInfo">
                                    <ul class="listDot colorRed">
                                        <li>· 가입하신 이메일로 임시 비밀번호가 전송됩니다.</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="height: 10px;"></div>
                            <div class="btnWrapper">
                                <a href="#;" class="btnL colorBlue" @click="resetMstPw"><span>확인</span></a>
                            </div>
                        </div>

                        <!-- Tab2 -->
                        <div class="tbMenuSubContent" id="tab_emp">
                            <h3 class="tts">직원 회원</h3>

                            <div class="tblWrapper resetPW">
                                <div style="height: 10px;"></div>
                                <div class="addMemberInfo">
                                    <p><strong>· 직원 회원은 대표 회원에게 요청하여 비밀번호 재설정이 가능합니다.</strong></p><br />
                                    <p>· 메뉴 : 로그인(대표회원) ▷ 매장 관리 ▷ 직원관리 ▷ 비밀번호 재발급</p>
                                </div>
                            </div>

                            <div class="btnWrapper">
                                <a href="#" class="btnL colorBlue popLayerIDPW_close"><span>확인</span></a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- //컨텐츠 -->
            </div>
        </div>
    </div>
<!-- //팝업: 아이디/비밀번호 찾기  -->
</div>

<div layout:fragment="script">
    <script type="text/javascript">
        // 로그인 실패 시 안내
        var loginStat = '[[${loginStat}]]'
        if (loginStat === 'FAIL') {
            alert('로그인 실패 했습니다.\nID와/또는 비밀번호를 확인해주세요.')
        } else if (loginStat.indexOf("FAIL_PWERR_CNT_") !== -1) {
            var pwerrCntStr = loginStat.slice(15)
            if (pwerrCntStr === 'OVER') {
                alert('로그인을 5회 이상 실패했습니다.\n\'비밀번호 찾기\'로 비밀변호를 재설정 해주세요.')
            } else {
                alert('로그인을 ' + pwerrCntStr + '회 실패했습니다.\n5회 이상 실패 시 로그인이 제한됩니다.')
            }
        }

        $(function () {
            // 레이어
            if ($(".layerWrapper").length) {
                //아이디/비밀번호 찾기
                $('#popLayerIDPW').popup();
            }

            // 회원관리 -> 회원정보 수정 탭 클릭
            $(".tbMenuSub li").click(function () {
                $(".tbMenuSub li").removeClass("on");
                $(this).addClass("on");

                var tabName = $(this).attr("data-target");

                $(".tbMenuSubContent").removeClass("on");
                $("#tab_" + tabName).addClass("on");
            });

            // 비밀번호 input 박스에서 enter 키 누를 시 로그인 버튼 클릭 처리
            $('#userPw').keypress(function(event){
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if(keycode == '13'){
                    $("#btnLogin").trigger("click");
                }
            });

            // 로그인 버튼 클릭 시 로그인 처리
            $("#btnLogin").click(function() {
                var userPw = $("#inputPw").val();
                var hashedPw = CryptoJS.SHA256(userPw).toString();
                $("#userPw").val(hashedPw);
                document.loginPostForm.submit();
            });
        });

        function delay10(delayedFn) {
            setTimeout(function() {
                delayedFn()
            }, 10)
        }

        var app = new Vue({
            el: "#app",
            data: {
                bnRegNo: '',
                ownerNm: '',
                mstMbrId: ''
            },
            methods: {
                initPop: function() {
                    this.bnRegNo = ''
                    this.ownerNm = ''
                    this.mstMbrId = ''
                },
                resetMstPw: function() {
                    var param = {
                        bnRegNo: this.bnRegNoND,
                        ownerNm: this.ownerNm,
                        mstMbrId: this.mstMbrId
                    }
                    cf_call('/member/resetMstPw', param, this.resetMstPwCB)
                    this.resetMstPwPost()
                },
                resetMstPwCB: function(rslt) {},
                resetMstPwPost: function() {
                    alert('가입정보 확인 후 가입하신 이메일로\n임시 비밀번호가 전송됩니다.')
                    $('#popLayerIDPW').popup('hide')
                    delay10(this.initPop())
                }
            },
            computed: {
                bnRegNoND: function() {
                    return this.bnRegNo.replaceAll('-', '')
                }
            }
        })
    </script>
</div>
</html>