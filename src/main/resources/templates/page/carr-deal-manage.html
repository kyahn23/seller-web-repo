<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default">

<!-- 판매정책별 판매상태 토글버튼 css -->
<th:block layout:fragment="css">
    <style>
        .tblList tr th:first-child, .tblList tr td:first-child {
            border-left: 1px solid #e1e3e8;
        }

        .toggle__button {
            vertical-align: middle;
            user-select: none;
            cursor: pointer;
        }

        .toggle__button input[type="checkbox"] {
            opacity: 0;
            position: absolute;
            width: 1px;
            height: 1px;
        }

        .toggle__button .toggle__switch {
            display: inline-block;
            height: 12px;
            border-radius: 6px;
            width: 30px;
            background: #BFCBD9;
            box-shadow: inset 0 0 1px #BFCBD9;
            position: relative;
            /*margin-left: 10px;*/
            transition: all .25s;
        }

        .toggle__button .toggle__switch::after,
        .toggle__button .toggle__switch::before {
            content: "";
            position: absolute;
            display: block;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            left: 0;
            top: -3px;
            transform: translateX(0);
            transition: all .25s cubic-bezier(.5, -.6, .5, 1.6);
        }

        .toggle__button .toggle__switch::after {
            background: #4D4D4D;
            box-shadow: 0 0 1px #666;
        }

        .toggle__button .toggle__switch::before {
            background: #4D4D4D;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            opacity: 0;
        }

        .active .toggle__switch {
            background: #adedcb;
            box-shadow: inset 0 0 1px #adedcb;
        }

        .active_pl .toggle__switch {
            background: #aee5f9;
            box-shadow: inset 0 0 1px #6bcff4;
        }

        .active .active_pl .toggle__switch::after,
        .active .active_pl .toggle__switch::before {
            transform: translateX(30px -18px);
        }

        .active .toggle__switch::after {
            left: 13px;
            background: #53B883;
            box-shadow: 0 0 1px #53B883;
        }

        .active_pl .toggle__switch::after {
            left: 13px;
            background: #0d84b0;
            box-shadow: 0 0 1px #0d84b0;
        }
    </style>
</th:block>

<div layout:fragment="content">
    <!-- contents -->
    <div class="sectionRight" id="content">
        <div class="contentWrap">
            <div class="onlyWideView">

                <div class="subHeader">
                    <div id="foldUnfold"><a href="#;" class="btnFold"><span>좌측메뉴 접기/펴기</span></a></div>
                    <h2 class="h2"><img th:src="@{/images/cmmn/hidden.png}" class="ico-list" alt="아이콘">판매정책관리
                    </h2>
                    <div class="pageLocation">
                        <span>{{carr.toUpperCase()}} 관리</span>&gt;<strong>판매정책관리</strong>
                    </div>
                </div>

                <div class="searchArea">
                    <ul>
                        <li class="txtSize4">
                            <label for="purchaes01">판매상태</label>
                            <select id="purchaes01" v-model="selectedSellOpt">
                                <option v-for="sell in sellYn" :value="sell.code">{{sell.value}}</option>
                            </select>
                        </li>
                        <li class="txtSize4">
                            <label for="purchaes02">제조사</label>
                            <select id="purchaes02" v-model="selectedMkr">
                                <option v-for="mkr in pnMkr" :value="mkr.code">{{mkr.value}}</option>
                            </select>
                        </li>
                        <li class="txtSize3">
                            <label for="purchaes03">모델명</label>
                            <input type="text" id="purchaes04" placeholder="모델명 입력" v-model="searchKey">
                        </li>
                        <li class="txtSize4">
                            <label for="purchaes03">통신유형</label>
                            <select id="purchaes03" v-model="selectedNetType">
                                <option v-for="net in networkType" :value="net.code">{{net.value}}</option>
                            </select>
                        </li>
                    </ul>
                    <div class="btnSearch">
                        <a href="#;" class="btnM colorBlue" @click="searchList"><span>검색</span></a>
                    </div>
                </div>

                <!-- content group1 -->
                <div class="contentBlock contentSlide">
                    <div class="contentTitle slideToggle">
                        <div class="cTit">
                            제품 현황
                            <span class="icon"></span>
                        </div>
                        <div class="cTitRight">
                            <a href="#;" class="btnM colorOrg" @click="stopSale"><span>판매중지</span></a>
                        </div>
                    </div>
                    <!-- slide content -->
                    <div class="contentDetail slideTogglebox">
                        <div class="tHeadScrollBG">
                            <div class="tHeadScroll">
                                <table class="tblList tHead">
                                    <colgroup>
                                        <col style="width:3%">
                                        <col style="width:7%">
                                        <col style="width:10%">
                                        <col style="width:12%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:*">
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th scope="col"><input type="checkbox" title="행 선택" @change.stop="checkAll"
                                                               v-model="allchecked"></th>
                                        <th scope="col">판매상태</th>
                                        <th scope="col">제조사</th>
                                        <th scope="col">모델명</th>
                                        <th scope="col">출고가</th>
                                        <th scope="col">통신유형</th>
                                        <th scope="col">용량</th>
                                        <th scope="col">모델코드</th>
                                        <th scope="col">등록자</th>
                                        <th scope="col">최종변경일시</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <div class="tBodyScroll">
                            <table class="tblList tBody trClick">
                                <colgroup>
                                    <col style="width:3%">
                                    <col style="width:7%">
                                    <col style="width:10%">
                                    <col style="width:12%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:*">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th scope="col"><input type="checkbox" title="행 선택"></th>
                                    <th scope="col">판매상태</th>
                                    <th scope="col">제조사</th>
                                    <th scope="col">모델명</th>
                                    <th scope="col">출고가</th>
                                    <th scope="col">통신유형</th>
                                    <th scope="col">용량</th>
                                    <th scope="col">모델코드</th>
                                    <th scope="col">등록자</th>
                                    <th scope="col">최종변경일시</th>
                                </tr>
                                </thead>
                                <tbody v-if="dpList.length !== 0">
                                <tr v-for="(sell,idx) in dpList"
                                    :class="{ checkedItem: getTrClass(idx) }">
                                    <td class="alignC"><input type="checkbox" title="행 선택" v-model="checkedList"
                                                              :value="sell" @change="chkboxClick"></td>
                                    <td class="alignC" v-if="sell.sellStatus === 'Y'" @click="rowClick(sell,idx)">판매중
                                    </td>
                                    <td class="alignC" v-else-if="sell.sellStatus === 'P'" @click="rowClick(sell,idx)">
                                        판매중지
                                    </td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">미판매</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMkr}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMdlNm}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">
                                        {{Number(sell.pnMsrp).toLocaleString()}}
                                    </td>
                                    <td class="alignC" v-if="sell.pnNetType === '4G'" @click="rowClick(sell,idx)">LTE
                                    </td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">{{sell.pnNetType}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnStor}}GB</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMdlNo}}</td>
                                    <td class="alignC" v-if="!sell.lastModiMbr" @click="rowClick(sell,idx)">-</td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">{{sell.lastModiMbrNm}}</td>
                                    <td class="alignC" v-if="!sell.lastModiDate" @click="rowClick(sell,idx)">-</td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">{{sell.lastModiDate}}</td>
                                </tr>
                                </tbody>
                                <tbody v-else>
                                <tr class="errorMessage">
                                    <td colspan="10">
                                        <div class="errorTxt">
                                            <span>항목이 없습니다.</span>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- //slide content -->
                </div>
                <!-- //content group1 -->

                <!-- content group2 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            <span>번호이동정책</span>
                        </div>
                        <div class="cTitRight">
                            <label for="modiYnMvCarr" :class="{'active_pl': modiYnMvCarr}"
                                   class="toggle__button">
                                <span v-if="modiYnMvCarr" class="toggle__label">수정중</span>
                                <span v-else class="toggle__label">수정하기</span>
                                <input type="checkbox" v-model="modiYnMvCarr" id="modiYnMvCarr"
                                       @click.prevent="modiPolicyToggle('moveCarr')">
                                <span class="toggle__switch"></span>
                            </label>
                            <a href="#;" v-if="modiYnMvCarr && modiPolicy === 'moveCarr'" class="btnM colorSky"
                               @click="savePolicy('moveCarr')"><span>번이정책 저장</span></a>
                            <a href="#;" v-else class="btnM disabled"><span>번이정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:15%">
                                <col style="width:7%">
                                <col style="width:9%">
                                <col style="width:11%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월<br>기본요금</th>
                                <th scope="col" rowspan="2">판매상태</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스<br>유무</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="moveCarrList.length !== 0">
                            <tr v-for="(list, idx) in moveCarrList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td>
                                    <label :for="'moveCarrYnBtn'+idx" :class="{'active': list.sellToggle}"
                                           class="toggle__button">
                                        <span v-if="list.sellYn === 'Y'" class="toggle__label">판매중</span>
                                        <span v-else class="toggle__label">미판매</span>

                                        <input type="checkbox" :id="'moveCarrYnBtn'+idx" v-model="list.sellToggle"
                                               @change="sellToggleBtn(list)" :disabled="!modiYnMvCarr">
                                        <span class="toggle__switch"></span>
                                    </label>
                                </td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           v-mask="'#######'" placeholder="공시지원금"
                                           :disabled="!list.sellToggle || !modiYnMvCarr">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           v-mask="'#######'" placeholder="공시 추가지원금"
                                           :disabled="!list.sellToggle || !modiYnMvCarr">
                                </td>
                                <td>
                                    {{setPrice1('move',idx,list.pnOfclSubsd, list.pnExtSubsdDv)}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선약 추가지원금" v-model="list.pnExtSubsdRt"
                                           v-mask="'#######'" :disabled="!list.sellToggle || !modiYnMvCarr">
                                </td>
                                <td>
                                    {{setPrice2('move',idx, list.pnExtSubsdRt)}}
                                </td>
                                <td>
                                    <input type="radio" :id="'mvCarrY'+idx" value="Y" v-model="list.pnExtServYn"
                                           :disabled="!list.sellToggle || !modiYnMvCarr">
                                    <label :for="'mvCarrY'+idx">유</label>
                                    <input type="radio" :id="'mvCarrN'+idx" value="N" v-model="list.pnExtServYn"
                                           :disabled="!list.sellToggle || !modiYnMvCarr">
                                    <label :for="'mvCarrN'+idx">무</label>
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc"
                                           :disabled="list.pnExtServYn === 'N' || !list.sellToggle || !modiYnMvCarr">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group2 -->

                <!-- content group3 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            기기변경정책
                        </div>
                        <div class="cTitRight">
                            <label for="modiYnChgDev" :class="{'active_pl': modiYnChgDev}"
                                   class="toggle__button">
                                <span v-if="modiYnChgDev" class="toggle__label">수정중</span>
                                <span v-else class="toggle__label">수정하기</span>
                                <input type="checkbox" v-model="modiYnChgDev" id="modiYnChgDev"
                                       @click.prevent="modiPolicyToggle('chgDevice')">
                                <span class="toggle__switch"></span>
                            </label>
                            <a href="#;" v-if="modiYnChgDev && modiPolicy === 'chgDevice'" class="btnM colorSky"
                               @click="savePolicy('chgDevice')"><span>기변정책 저장</span></a>
                            <a href="#;" v-else class="btnM disabled"><span>기변정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:15%">
                                <col style="width:7%">
                                <col style="width:9%">
                                <col style="width:11%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월<br>기본요금</th>
                                <th scope="col" rowspan="2">판매상태</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스<br>유무</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="chgDeviceList.length !== 0">
                            <tr v-for="(list, idx) in chgDeviceList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td>
                                    <label :for="'chgDeviceYnBtn'+idx" :class="{'active': list.sellToggle}"
                                           class="toggle__button">
                                        <span v-if="list.sellYn === 'Y'" class="toggle__label">판매중</span>
                                        <span v-else class="toggle__label">미판매</span>

                                        <input type="checkbox" :id="'chgDeviceYnBtn'+idx" v-model="list.sellToggle"
                                               @change="sellToggleBtn(list)" :disabled="!modiYnChgDev">
                                        <span class="toggle__switch"></span>
                                    </label>
                                </td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           v-mask="'#######'" placeholder="공시지원금"
                                           :disabled="!list.sellToggle || !modiYnChgDev">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           v-mask="'#######'" placeholder="공시 추가지원금"
                                           :disabled="!list.sellToggle || !modiYnChgDev">
                                </td>
                                <td>
                                    {{setPrice1('chg',idx,list.pnOfclSubsd, list.pnExtSubsdDv)}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선약 추가지원금" v-model="list.pnExtSubsdRt"
                                           v-mask="'#######'" :disabled="!list.sellToggle || !modiYnChgDev">
                                </td>
                                <td>
                                    {{setPrice2('chg',idx,list.pnExtSubsdRt)}}
                                </td>
                                <td>
                                    <input type="radio" :id="'idxY'+idx" value="Y" v-model="list.pnExtServYn"
                                           :disabled="!list.sellToggle || !modiYnChgDev">
                                    <label :for="'idxY'+idx">유</label>
                                    <input type="radio" :id="'idxN'+idx" value="N" v-model="list.pnExtServYn"
                                           @change="list.pnEtc = ''" :disabled="!list.sellToggle || !modiYnChgDev">
                                    <label :for="'idxN'+idx">무</label>
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc"
                                           :disabled="list.pnExtServYn === 'N' || !list.sellToggle || !modiYnChgDev">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group3 -->

                <!-- content group4 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            신규가입정책
                        </div>
                        <div class="cTitRight">
                            <label for="modiYnNewSignUp" :class="{'active_pl': modiYnNewSignUp}"
                                   class="toggle__button">
                                <span v-if="modiYnNewSignUp" class="toggle__label">수정중</span>
                                <span v-else class="toggle__label">수정하기</span>
                                <input type="checkbox" v-model="modiYnNewSignUp" id="modiYnNewSignUp"
                                       @click.prevent="modiPolicyToggle('newSignUp')">
                                <span class="toggle__switch"></span>
                            </label>
                            <a href="#;" v-if="modiYnNewSignUp && modiPolicy === 'newSignUp'" class="btnM colorSky"
                               @click="savePolicy('newSignUp')"><span>신규정책 저장</span></a>
                            <a href="#;" v-else class="btnM disabled"><span>신규정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:15%">
                                <col style="width:7%">
                                <col style="width:9%">
                                <col style="width:11%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:11%">
                                <col style="width:7%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월<br>기본요금</th>
                                <th scope="col" rowspan="2">판매상태</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스<br>유무</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="newSignUpList.length !== 0">
                            <tr v-for="(list, idx) in newSignUpList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td>
                                    <label :for="'newSignUpYnBtn'+idx" :class="{'active': list.sellToggle}"
                                           class="toggle__button">
                                        <span v-if="list.sellYn === 'Y'" class="toggle__label">판매중</span>
                                        <span v-else class="toggle__label">미판매</span>

                                        <input type="checkbox" :id="'newSignUpYnBtn'+idx" v-model="list.sellToggle"
                                               @change="sellToggleBtn(list)" :disabled="!modiYnNewSignUp">
                                        <span class="toggle__switch"></span>
                                    </label>
                                </td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           v-mask="'#######'" placeholder="공시지원금"
                                           :disabled="!list.sellToggle || !modiYnNewSignUp">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           v-mask="'#######'" placeholder="공시 추가지원금"
                                           :disabled="!list.sellToggle || !modiYnNewSignUp">
                                </td>
                                <td>
                                    {{setPrice1('new',idx,list.pnOfclSubsd, list.pnExtSubsdDv)}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선약 추가지원금" v-model="list.pnExtSubsdRt"
                                           v-mask="'#######'" :disabled="!list.sellToggle || !modiYnNewSignUp">
                                </td>
                                <td>
                                    {{setPrice2('new',idx,list.pnExtSubsdRt)}}
                                </td>
                                <td>
                                    <input type="radio" :id="'idxY'+idx" value="Y" v-model="list.pnExtServYn"
                                           :disabled="!list.sellToggle">
                                    <label :for="'idxY'+idx">유</label>
                                    <input type="radio" :id="'idxN'+idx" value="N" v-model="list.pnExtServYn"
                                           :disabled="!list.sellToggle || !modiYnNewSignUp"
                                           @change="list.pnEtc = ''">
                                    <label :for="'idxN'+idx">무</label>
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc"
                                           :disabled="list.pnExtServYn === 'N' || !list.sellToggle || !modiYnNewSignUp">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group4 -->

            </div>
        </div>
    </div>
    <!-- //contents -->

</div>

<div layout:fragment="script">
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                modiPolicy: '',
                modiYnMvCarr: false,
                modiYnChgDev: false,
                modiYnNewSignUp: false,
                deviceCarr: "",
                carr: "",
                sellYn: [
                    {code: "all", value: "전체"},
                    {code: "y", value: "판매중"},
                    {code: "p", value: "판매중지"},
                    {code: "n", value: "미판매"}
                ],
                selectedSellOpt: "all",
                pnMkr: [
                    {code: "all", value: "전체"},
                    {code: "SAM", value: "삼성전자"},
                    {code: "APP", value: "애플"},
                    {code: "LGE", value: "LG전자"},
                    // {code: "XIA", value: "샤오미"},
                    {code: "ETC", value: "기타"}
                ],
                selectedMkr: "all",
                searchKey: "",
                networkType: [
                    {code: "all", value: "전체"},
                    {code: "5g", value: "5G"},
                    {code: "4g", value: "LTE"},
                    {code: "3g", value: "3G"}
                ],
                selectedNetType: "all",
                allchecked: false,
                checkedList: [],
                dpList: [],
                selectDevice: {},
                moveCarrList: [],
                chgDeviceList: [],
                newSignUpList: [],
                selectPolicy: []
            },
            mounted: function () {
                var currentPath = window.location.pathname
                this.carr = currentPath.substring(currentPath.lastIndexOf('/') + 1)
                switch (this.carr) {
                    case 'skt':
                        this.deviceCarr = 'S'
                        break
                    case 'kt':
                        this.deviceCarr = 'K'
                        break
                    case 'lgu':
                        this.deviceCarr = 'L'
                        break
                }
                this.searchList()
            },
            computed: {},
            methods: {
                searchList: function () {
                    var param = {
                        mntCarr: this.carr,
                        deviceCarr: this.deviceCarr,
                        selectedNetType: this.selectedNetType,
                        pnMkr: this.selectedMkr,
                        searchKey: this.searchKey
                    }
                    cf_call("/carr/getSellDeviceList", param, this.searchListCB)
                },
                searchListCB: function (data) {
                    this.dpList = []
                    switch (this.selectedSellOpt) {
                        case 'y' :
                            for (var i = 0; i < data.sellDeviceList.length; i++) {
                                if (data.sellDeviceList[i].sellStatus === 'Y') {
                                    this.dpList.push(data.sellDeviceList[i])
                                }
                            }
                            break
                        case 'p' :
                            for (var i = 0; i < data.sellDeviceList.length; i++) {
                                if (data.sellDeviceList[i].sellStatus === 'P') {
                                    this.dpList.push(data.sellDeviceList[i])
                                }
                            }
                            break
                        case "n" :
                            for (var i = 0; i < data.sellDeviceList.length; i++) {
                                if (data.sellDeviceList[i].sellStatus === 'N') {
                                    this.dpList.push(data.sellDeviceList[i])
                                }
                            }
                            break
                        default:
                            this.dpList = data.sellDeviceList
                            break
                    }
                    for (var i = 0; i < this.dpList.length; i++) {
                        this.dpList[i].idx = i
                        this.dpList[i].mntCarr = this.carr.toUpperCase()

                        switch (this.dpList[i].pnMkr) {
                            case 'SAM':
                                this.dpList[i].pnMkr = '삼성전자'
                                break
                            case 'LGE':
                                this.dpList[i].pnMkr = 'LG전자'
                                break
                            case 'APP':
                                this.dpList[i].pnMkr = '애플'
                                break
                            case 'XIA':
                                this.dpList[i].pnMkr = '샤오미'
                                break
                            case 'ETC':
                                this.dpList[i].pnMkr = '기타'
                                break
                        }
                    }
                },
                getTrClass: function (idx) {
                    if (idx === this.selectDevice.idx) return true
                    else return false
                },
                checkAll: function () {
                    this.checkedList = []

                    if (this.allchecked) {
                        for (var i = 0; i < this.dpList.length; i++) {
                            this.checkedList.push(this.dpList[i])
                        }
                    }
                },
                chkboxClick: function () {
                    this.allchecked = false
                    if (this.checkedList.length === this.dpList.length) {
                        this.allchecked = true
                    }
                },

                rowClick: function (data, idx) {
                    if (this.modiPolicy !== '') {
                        if (confirm('현재 ' + this.selectDevice.pnMdlNm + ' ' + this.selectDevice.pnStor + 'GB '
                            + this.policyChk(this.modiPolicy, 'policyNm') + ' 정책을 수정중입니다. \n모델을 변경하시겠습니까?')) {
                            this.modiYn(this.modiPolicy, false)
                            this.modiPolicy = ''
                            this.selectPolicy = []

                            this.selectDevice = {}
                            this.selectDevice = data
                            this.selectDevice.idx = idx

                            var param = {
                                pnCarr: this.carr.toUpperCase(),
                                pnNetType: this.selectDevice.pnNetType,
                                pnStor: this.selectDevice.pnStor,
                                pnMdlNo: this.selectDevice.pnMdlNo
                            }
                            cf_call("/carr/getUseMntByDevice", param, this.rowClickCB)
                        }
                    } else {
                        if (this.selectDevice.idx != idx) {
                            this.selectDevice = {}
                            this.selectDevice = data
                            this.selectDevice.idx = idx

                            var param = {
                                pnCarr: this.carr.toUpperCase(),
                                pnNetType: this.selectDevice.pnNetType,
                                pnStor: this.selectDevice.pnStor,
                                pnMdlNo: this.selectDevice.pnMdlNo
                            }
                            cf_call("/carr/getUseMntByDevice", param, this.rowClickCB)
                        } else {
                            this.selectDevice = {}
                            this.currPolicy = {}
                            this.moveCarrList = []
                            this.chgDeviceList = []
                            this.newSignUpList = []
                        }
                    }

                },
                rowClickCB: function (data) {
                    this.moveCarrList = []
                    this.chgDeviceList = []
                    this.newSignUpList = []

                    this.moveCarrList = data.moveCarrList
                    for (var i = 0; i < this.moveCarrList.length; i++) {
                        if (this.moveCarrList[i].sellYn === 'Y') {
                            this.moveCarrList[i].sellToggle = true
                        } else {
                            this.moveCarrList[i].sellToggle = false
                        }
                        this.moveCarrList[i].sellYnOrg = this.moveCarrList[i].sellYn
                        this.moveCarrList[i].pnOfclSubsdOrg = this.moveCarrList[i].pnOfclSubsd
                        this.moveCarrList[i].pnExtSubsdDvOrg = this.moveCarrList[i].pnExtSubsdDv
                        this.moveCarrList[i].pnExtSubsdRtOrg = this.moveCarrList[i].pnExtSubsdRt
                        this.moveCarrList[i].pnEtcOrg = this.moveCarrList[i].pnEtc
                        this.moveCarrList[i].pnExtServYnOrg = this.moveCarrList[i].pnExtServYn
                    }


                    // for (idx in this.moveCarrList) {
                    //     if (this.moveCarrList[idx].sellYn === 'Y') {
                    //         this.moveCarrList[idx].sellToggle = true
                    //     } else {
                    //         this.moveCarrList[idx].sellToggle = false
                    //     }
                    //     this.moveCarrList[idx].sellYnOrg = this.moveCarrList[idx].sellYn
                    //     this.moveCarrList[idx].pnOfclSubsdOrg = this.moveCarrList[idx].pnOfclSubsd
                    //     this.moveCarrList[idx].pnExtSubsdDvOrg = this.moveCarrList[idx].pnExtSubsdDv
                    //     this.moveCarrList[idx].pnExtSubsdRtOrg = this.moveCarrList[idx].pnExtSubsdRt
                    //     this.moveCarrList[idx].pnEtcOrg = this.moveCarrList[idx].pnEtc
                    //     this.moveCarrList[idx].pnExtServYnOrg = this.moveCarrList[idx].pnExtServYn
                    // }
                    this.chgDeviceList = data.chgDeviceList
                    for (var i = 0; i < this.chgDeviceList.length; i++) {
                        if (this.chgDeviceList[i].sellYn === 'Y') {
                            this.chgDeviceList[i].sellToggle = true
                        } else {
                            this.chgDeviceList[i].sellToggle = false
                        }
                        this.chgDeviceList[i].sellYnOrg = this.chgDeviceList[i].sellYn
                        this.chgDeviceList[i].pnOfclSubsdOrg = this.chgDeviceList[i].pnOfclSubsd
                        this.chgDeviceList[i].pnExtSubsdDvOrg = this.chgDeviceList[i].pnExtSubsdDv
                        this.chgDeviceList[i].pnExtSubsdRtOrg = this.chgDeviceList[i].pnExtSubsdRt
                        this.chgDeviceList[i].pnEtcOrg = this.chgDeviceList[i].pnEtc
                        this.chgDeviceList[i].pnExtServYnOrg = this.chgDeviceList[i].pnExtServYn
                    }

                    // for (idx in this.chgDeviceList) {
                    //     if (this.chgDeviceList[idx].sellYn === 'Y') {
                    //         this.chgDeviceList[idx].sellToggle = true
                    //     } else {
                    //         this.chgDeviceList[idx].sellToggle = false
                    //     }
                    //     this.chgDeviceList[idx].sellYnOrg = this.chgDeviceList[idx].sellYn
                    //     this.chgDeviceList[idx].pnOfclSubsdOrg = this.chgDeviceList[idx].pnOfclSubsd
                    //     this.chgDeviceList[idx].pnExtSubsdDvOrg = this.chgDeviceList[idx].pnExtSubsdDv
                    //     this.chgDeviceList[idx].pnExtSubsdRtOrg = this.chgDeviceList[idx].pnExtSubsdRt
                    //     this.chgDeviceList[idx].pnEtcOrg = this.chgDeviceList[idx].pnEtc
                    //     this.chgDeviceList[idx].pnExtServYnOrg = this.chgDeviceList[idx].pnExtServYn
                    // }

                    this.newSignUpList = data.newSignUpList
                    for (var i = 0; i < this.newSignUpList.length; i++) {
                        if (this.newSignUpList[i].sellYn === 'Y') {
                            this.newSignUpList[i].sellToggle = true
                        } else {
                            this.newSignUpList[i].sellToggle = false
                        }
                        this.newSignUpList[i].sellYnOrg = this.newSignUpList[i].sellYn
                        this.newSignUpList[i].pnOfclSubsdOrg = this.newSignUpList[i].pnOfclSubsd
                        this.newSignUpList[i].pnExtSubsdDvOrg = this.newSignUpList[i].pnExtSubsdDv
                        this.newSignUpList[i].pnExtSubsdRtOrg = this.newSignUpList[i].pnExtSubsdRt
                        this.newSignUpList[i].pnEtcOrg = this.newSignUpList[i].pnEtc
                        this.newSignUpList[i].pnExtServYnOrg = this.newSignUpList[i].pnExtServYn
                    }

                    // for (idx in this.newSignUpList) {
                    //     if (this.newSignUpList[idx].sellYn === 'Y') {
                    //         this.newSignUpList[idx].sellToggle = true
                    //     } else {
                    //         this.newSignUpList[idx].sellToggle = false
                    //     }
                    //     this.newSignUpList[idx].sellYnOrg = this.newSignUpList[idx].sellYn
                    //     this.newSignUpList[idx].pnOfclSubsdOrg = this.newSignUpList[idx].pnOfclSubsd
                    //     this.newSignUpList[idx].pnExtSubsdDvOrg = this.newSignUpList[idx].pnExtSubsdDv
                    //     this.newSignUpList[idx].pnExtSubsdRtOrg = this.newSignUpList[idx].pnExtSubsdRt
                    //     this.newSignUpList[idx].pnEtcOrg = this.newSignUpList[idx].pnEtc
                    //     this.newSignUpList[idx].pnExtServYnOrg = this.newSignUpList[idx].pnExtServYn
                    // }
                },
                stopSale: function () {
                    var saleYn = false
                    if (!this.checkedList.length) alert('판매중지할 모델을 선택해주세요.')
                    else {
                        if (confirm('선택하신 모델의 판매를 중지하시겠습니까?')) {
                            for (var i = 0; i < this.checkedList.length; i++) {
                                if (this.checkedList[i].sellStatus !== 'Y') {
                                    saleYn = true
                                }
                            }

                            // for (idx in this.checkedList) {
                            //     // sellYn의 값이 없으면(미판매) true
                            //     if (!this.checkedList[idx].sellStatus) saleYn = true
                            // }
                            // 판매상태 - 미판매중인
                            if (saleYn) alert("선택하신 모델의 판매상태를 확인해주세요.")
                            else {
                                cf_call("/carr/stopSaleDev", this.checkedList, this.stopSaleCB)
                            }
                        }
                    }
                },
                stopSaleCB: function (data) {
                    alert('선택하신 모델의 판매가 중지되었습니다.')
                    if (data.succ === "Y") {
                        this.selectDevice = {}
                        this.checkedList = []
                        this.moveCarrList = []
                        this.chgDeviceList = []
                        this.newSignUpList = []
                        this.searchList()
                    }
                },
                sellToggleBtn: function (data) {
                    if (data.sellToggle === true) {
                        data.sellYn = 'Y'
                    } else {
                        data.sellYn = 'N'
                    }
                },
                savePolicy: function (type) {
                    var tempArr = []
                    var keyword = ''
                    switch (type) {
                        case 'moveCarr' :
                            tempArr = this.moveCarrList
                            keyword = '번호이동'
                            break
                        case 'chgDevice' :
                            tempArr = this.chgDeviceList
                            keyword = '기기변경'
                            break
                        case 'newSignUp' :
                            tempArr = this.newSignUpList
                            keyword = '신규가입'
                            break
                    }
                    if (!tempArr.length) alert('정책을 저장할 모델을 선택해주세요')
                    else {
                        if (confirm(keyword + '정책을 저장하시겠습니까?')) {
                            for (idx in tempArr) {
                                tempArr[idx].pnMdlNo = this.selectDevice.pnMdlNo
                                tempArr[idx].pnStor = this.selectDevice.pnStor
                                tempArr[idx].mntCarr = this.carr.toUpperCase()


                                if (this.changeChk(tempArr[idx])) {
                                    tempArr[idx].saveYn = 'N' // return true. 값 변동 없음
                                } else {
                                    tempArr[idx].saveYn = 'Y' // return false. 값 변동 있음
                                }

                                if (tempArr[idx].saveYn === 'Y') {
                                    if (tempArr[idx].sellYn === 'Y') {
                                        if (!tempArr[idx].pnOfclSubsd) {
                                            alert('공시지원금을 입력해주세요.')
                                            return
                                        }
                                        if (!tempArr[idx].pnExtSubsdDv) {
                                            alert('공시 추가지원금을 입력해주세요.')
                                            return
                                        }
                                        if (!tempArr[idx].pnExtSubsdRt) {
                                            alert('선택약정 추가지원금을 입력해주세요.')
                                            return
                                        }
                                        if (tempArr[idx].pnExtSubsdDv && tempArr[idx].pnExtSubsdRt && tempArr[idx].pnOfclSubsd) {
                                            tempArr[idx].pnOfclSubsd = tempArr[idx].pnOfclSubsd.replaceAll(',', '')     // 공시지원금
                                            tempArr[idx].pnExtSubsdDv = tempArr[idx].pnExtSubsdDv.replaceAll(',', '')    // 공시추가지원금
                                            tempArr[idx].pnExtSubsdRt = tempArr[idx].pnExtSubsdRt.replaceAll(',', '')    // 선약 추가지원금
                                        }

                                        if (!tempArr[idx].pnExtServYn) {
                                            alert('부가서비스 유무를 선택해주세요.')
                                            return
                                        }
                                        if (tempArr[idx].pnExtServYn === 'Y') {
                                            if (!tempArr[idx].pnEtc) {
                                                alert('부가서비스 정책을 입력해주세요.')
                                                return
                                            }
                                        }
                                    }
                                }
                            }

                            cf_call("/carr/saveSalePolicy/" + type, tempArr, this.savePolicyCB)
                        }
                    }
                },
                savePolicyCB: function (data) {
                    if (data.succ === "Y") {
                        alert('저장되었습니다.')
                        this.modiYn(this.modiPolicy, false)
                        this.modiPolicy = ''
                        this.selectDevice = {}
                        this.checkedList = []
                        this.moveCarrList = []
                        this.chgDeviceList = []
                        this.newSignUpList = []
                        this.searchList()
                    }
                },
                changeChk: function (data) {
                    var sellYn = data.sellYnOrg === data.sellYn
                    var pnOfclSubsd = data.pnOfclSubsdOrg === data.pnOfclSubsd
                    var pnExtSubsdDv = data.pnExtSubsdDvOrg === data.pnExtSubsdDv
                    var pnExtSubsdRt = data.pnExtSubsdRtOrg === data.pnExtSubsdRt
                    var pnEtc = data.pnEtcOrg === data.pnEtc
                    return (sellYn && pnOfclSubsd && pnExtSubsdDv && pnExtSubsdRt && pnEtc)
                },
                setPrice1: function (policyNm, idx, val1, val2) {  // 공시 할부원금계산
                    var pnMsrp = 0;
                    pnMsrp = this.selectDevice.pnMsrp// 출고가
                    var pnOfclSubsd = val1  // 공시지원금
                    var pnExtSubsdDv = val2 // 공시 추가지원금
                    var keyword = []
                    switch (policyNm) {
                        case 'move':
                            keyword = this.moveCarrList
                            break
                        case 'chg':
                            keyword = this.chgDeviceList
                            break
                        case 'new':
                            keyword = this.newSignUpList
                            break
                    }
                    if (val1 !== undefined && val1 !== null) {
                        pnOfclSubsd = pnOfclSubsd.replaceAll(',', '')
                        if (Number(pnMsrp - pnOfclSubsd) < 0) {
                            alert('입력하신 공시지원금을 확인해주세요.')
                            keyword[idx].pnOfclSubsd = keyword[idx].pnOfclSubsd.substring(0, keyword[idx].pnOfclSubsd.length - 1)
                            // pnOfclSubsd = pnOfclSubsd.substring(0, pnOfclSubsd.length)
                            return
                        }
                    }

                    if (val1 !== undefined && val1 !== null && val2 !== undefined && val2 !== null) {
                        pnOfclSubsd = val1.replaceAll(',', '')
                        pnExtSubsdDv = val2.replaceAll(',', '')
                        var rslt = Number(pnMsrp) - Number(pnOfclSubsd) - Number(pnExtSubsdDv)
                        // if (rslt < 0) {
                        //     alert('입력하신 공시 추가지원금을 확인해주세요.')
                        //     keyword[idx].pnExtSubsdDv = keyword[idx].pnExtSubsdDv.substring(0, keyword[idx].pnExtSubsdDv.length - 1)
                        //     return
                        // } else
                        return rslt.toLocaleString()
                    } else {
                        return cf_numberFormat(pnMsrp)
                    }

                },
                setPrice2: function (policyNm, idx, val) {     // 선약 할부원금 계산
                    var keyword = []
                    switch (policyNm) {
                        case 'move':
                            keyword = this.moveCarrList
                            break
                        case 'chg':
                            keyword = this.chgDeviceList
                            break
                        case 'new':
                            keyword = this.newSignUpList
                            break
                    }

                    var pnMsrp = this.selectDevice.pnMsrp
                    if (val !== undefined && val !== null) {
                        var pnExtSubsdRt = val.replaceAll(',', '')
                        var rslt = Number(pnMsrp - pnExtSubsdRt)
                        // if (rslt < 0) {
                        //     alert('입력하신 선택약정 추가지원금액을\n 확인해주세요.')
                        //     // pnExtSubsdRt = pnExtSubsdRt.substring(0, pnExtSubsdRt.length)
                        //     keyword[idx].pnExtSubsdRt = keyword[idx].pnExtSubsdRt.substring(0, keyword[idx].pnExtSubsdRt.length - 1)
                        //     return
                        // } else
                        return rslt.toLocaleString()
                    } else {
                        return cf_numberFormat(pnMsrp)
                    }
                },
                modiPolicyToggle(policy) {
                    if (!this.selectDevice.pnMdlNo) {
                        alert('정책을 수정할 모델을 선택해주세요')
                        return
                    }
                    if (this.modiPolicy === '') {
                        this.policyChk(policy, 'policyList') //수정중인 판매정책 리스트 선택
                        this.modiPolicy = policy
                        this.modiYn(policy, true)
                        return
                        // }
                    } else {
                        if (this.modiPolicy === policy) {
                            if (confirm(this.policyChk(policy, 'policyNm') + ' 판매정책 수정을 취소하시겠습니까?')) {
                                this.modiYn(policy, false)
                                this.modiPolicy = ''
                                this.policyChk(policy, 'restore') // 판매정책 수정값이 있을시 복원

                                this.selectPolicy = []
                                return
                            }
                        } else {
                            if (confirm('현재 ' + this.policyChk(this.modiPolicy, 'policyNm') + ' 정책이 수정중입니다.\n수정할 정책을 변경하시겠습니까?')) {
                                this.policyChk(this.modiPolicy, 'restore') // 판매정책 수정값이 있을시 복원
                                this.modiYn(this.modiPolicy, false)

                                this.policyChk(policy, 'policyList') //수정중인 판매정책 리스트 선택
                                this.modiPolicy = policy
                                this.modiYn(policy, true)
                                return
                            }
                        }
                    }
                },
                modiYn: function (policy, value) {  // 판매정책 수정상태
                    switch (policy) {
                        case 'moveCarr' :
                            this.modiYnMvCarr = value
                            break
                        case 'chgDevice' :
                            this.modiYnChgDev = value
                            break
                        case 'newSignUp' :
                            this.modiYnNewSignUp = value
                            break
                    }
                },
                policyNm: function(val){
                  var plNm = ''
                  switch (val) {
                      case 'moveCarr' :
                          plNm = '번호이동'
                          break
                      case 'chgDevice' :
                          plNm = '기기변경'
                          break
                      case 'newSignUp' :
                          plNm = '신규가입'
                          break
                  }
                  return plNm
                },
                policyList: function(val){
                    switch (val) {
                        case 'moveCarr' :
                            this.selectPolicy = JSON.parse(JSON.stringify(this.moveCarrList))
                            break
                        case 'chgDevice' :
                            this.selectPolicy = JSON.parse(JSON.stringify(this.chgDeviceList))
                            break
                        case 'newSignUp' :
                            this.selectPolicy = JSON.parse(JSON.stringify(this.newSignUpList))
                            break
                    }
                },
                policyChk: function (policy, val) {

                    if (val === 'policyNm'){ //판매정책 이름
                        switch (policy) {
                            case 'moveCarr' :
                                policyKr = '번호이동'
                                break
                            case 'chgDevice' :
                                policyKr = '기기변경'
                                break
                            case 'newSignUp' :
                                policyKr = '신규가입'
                                break
                        }
                        return policyKr;
                    } else {
                        switch (val) {
                            case 'policyList' : //수정중인 판매정책 리스트 선택
                                switch (policy) {
                                    case 'moveCarr' :
                                        this.selectPolicy = JSON.parse(JSON.stringify(this.moveCarrList))
                                        break
                                    case 'chgDevice' :
                                        this.selectPolicy = JSON.parse(JSON.stringify(this.chgDeviceList))
                                        break
                                    case 'newSignUp' :
                                        this.selectPolicy = JSON.parse(JSON.stringify(this.newSignUpList))
                                        break
                                }
                                break
                            case 'restore' :    // 판매정책 수정값이 있을시 복원
                                switch (policy) {
                                    case 'moveCarr' :
                                        this.moveCarrList = this.selectPolicy
                                        break
                                    case 'chgDevice' :
                                        this.chgDeviceList = this.selectPolicy
                                        break
                                    case 'newSignUp' :
                                        this.newSignUpList = this.selectPolicy
                                        break
                                }
                                break
                        }
                    }
                }
            }
        })
    </script>
</div>


</html>