<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default">

<div layout:fragment="content">
    <!-- contents -->
    <div class="sectionRight" id="content">
        <div class="contentWrap">
            <div class="onlyWideView">

                <div class="subHeader">
                    <div id="foldUnfold"><a href="#" class="btnFold"><span>좌측메뉴 접기/펴기</span></a></div>
                    <h2 class="h2"><img th:src="@{/images/cmmn/hidden.png}" class="ico-list" alt="아이콘">판매정책관리
                    </h2>
                    <div class="pageLocation">
                        <span>{{carr.toUpperCase()}} 관리</span>&gt;<strong>판매정책관리</strong>
                    </div>
                </div>

                <div class="searchArea">
                    <ul>
                        <li class="txtSize4">
                            <label for="purchaes01">판매상태</label>
                            <select id="purchaes01" v-model="selectedSellOpt">
                                <option v-for="sell in sellYn" :value="sell.code">{{sell.value}}</option>
                            </select>
                        </li>
                        <li class="txtSize4">
                            <label for="purchaes02">제조사</label>
                            <select id="purchaes02" v-model="selectedMkr">
                                <option v-for="mkr in pnMkr" :value="mkr.code">{{mkr.value}}</option>
                            </select>
                        </li>
                        <li class="txtSize3">
                            <label for="purchaes03">모델명</label>
                            <input type="text" id="purchaes04" placeholder="모델명 입력" v-model="searchKey">
                        </li>
                        <li class="txtSize4">
                            <label for="purchaes03">통신유형</label>
                            <select id="purchaes03" v-model="selectedNetType">
                                <option v-for="net in networkType" :value="net.code">{{net.value}}</option>
                            </select>
                        </li>
                    </ul>
                    <div class="btnSearch">
                        <a href="#none" class="btnM colorBlue" @click="searchList"><span>검색</span></a>
                    </div>
                </div>

                <!-- content group1 -->
                <div class="contentBlock contentSlide">
                    <div class="contentTitle slideToggle">
                        <div class="cTit">
                            제품 현황
                            <span class="icon"></span>
                        </div>
                        <div class="cTitRight">
                            <a href="#none" class="btnM colorOrg" @click="stopSale"><span>판매중지</span></a>
                        </div>
                    </div>
                    <!-- slide content -->
                    <div class="contentDetail slideTogglebox">
                        <div class="tHeadScrollBG">
                            <div class="tHeadScroll">
                                <table class="tblList tHead">
                                    <colgroup>
                                        <col style="width:3%">
                                        <col style="width:7%">
                                        <col style="width:10%">
                                        <col style="width:12%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:10%">
                                        <col style="width:*">
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th scope="col"><input type="checkbox" title="행 선택" @change="checkAll"
                                                               v-model="allchecked"></th>
                                        <th scope="col">판매상태</th>
                                        <th scope="col">제조사</th>
                                        <th scope="col">모델명</th>
                                        <th scope="col">출고가</th>
                                        <th scope="col">통신유형</th>
                                        <th scope="col">용량</th>
                                        <th scope="col">모델코드</th>
                                        <th scope="col">등록자</th>
                                        <th scope="col">최종변경일시</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <div class="tBodyScroll">
                            <table class="tblList tBody trClick">
                                <colgroup>
                                    <col style="width:3%">
                                    <col style="width:7%">
                                    <col style="width:10%">
                                    <col style="width:12%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:10%">
                                    <col style="width:*">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th scope="col"><input type="checkbox" title="행 선택"></th>
                                    <th scope="col">판매상태</th>
                                    <th scope="col">제조사</th>
                                    <th scope="col">모델명</th>
                                    <th scope="col">출고가</th>
                                    <th scope="col">통신유형</th>
                                    <th scope="col">용량</th>
                                    <th scope="col">모델코드</th>
                                    <th scope="col">등록자</th>
                                    <th scope="col">최종변경일시</th>
                                </tr>
                                </thead>
                                <tbody v-if="dpList.length !== 0">
                                <tr v-for="(sell,idx) in dpList"
                                    :class="{ checkedItem: getTrClass(idx) }">
                                    <td class="alignC"><input type="checkbox" title="행 선택" v-model="checkedList"
                                                              :value="sell" @change="chkboxClick"></td>
                                    <td class="alignC" v-if="sell.sellStatus === 'Y'" @click="rowClick(sell,idx)">판매중
                                    </td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">-</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMkr}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMdlNm}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">
                                        {{Number(sell.pnMsrp).toLocaleString()}}
                                    </td>
                                    <td class="alignC" v-if="sell.pnNetType === '4G'" @click="rowClick(sell,idx)">LTE
                                    </td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnNetType}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnStor}}</td>
                                    <td class="alignC" @click="rowClick(sell,idx)">{{sell.pnMdlNo}}</td>
                                    <td class="alignC" v-if="!sell.lastModiMbr" @click="rowClick(sell,idx)">-</td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">{{sell.lastModiMbr}}</td>
                                    <td class="alignC" v-if="!sell.lastModiDate" @click="rowClick(sell,idx)">-</td>
                                    <td class="alignC" v-else @click="rowClick(sell,idx)">{{sell.lastModiDate}}</td>
                                </tr>
                                </tbody>
                                <tbody v-else>
                                <tr class="errorMessage">
                                    <td colspan="10">
                                        <div class="errorTxt">
                                            <span>항목이 없습니다.</span>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- //slide content -->
                </div>
                <!-- //content group1 -->

                <!-- content group2 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            번호이동정책
                        </div>
                        <div class="cTitRight">
                            <a href="#" class="btnM colorSky"><span>번이정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:16%">
                                <col style="width:7%">
                                <col style="width:14%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월 기본요금</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="moveCarrList.length !== 0">
                            <tr v-for="list in moveCarrList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           placeholder="공시지원금">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           placeholder="공시 추가지원금">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnOfclSubsd -
                                    list.pnExtSubsdDv).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선택약정 추가지원금" v-model="list.pnExtSubsdRt">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnExtSubsdRt).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group2 -->

                <!-- content group3 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            기기변경정책
                        </div>
                        <div class="cTitRight">
                            <a href="#" class="btnM colorSky"><span>기변정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:16%">
                                <col style="width:7%">
                                <col style="width:14%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월 기본요금</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="chgDeviceList.length !== 0">
                            <tr v-for="list in chgDeviceList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           placeholder="공시지원금">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           placeholder="공시 추가지원금">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnOfclSubsd -
                                    list.pnExtSubsdDv).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선택약정 추가지원금" v-model="list.pnExtSubsdRt">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnExtSubsdRt).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group3 -->

                <!-- content group4 -->
                <div class="contentBlock">
                    <div class="contentTitle">
                        <div class="cTit">
                            신규가입정책
                        </div>
                        <div class="cTitRight">
                            <a href="#" class="btnM colorSky"><span>신규정책 저장</span></a>
                        </div>
                    </div>
                    <!-- content -->
                    <div class="contentDetail">
                        <table class="tblList alignC">
                            <colgroup>
                                <col style="width:16%">
                                <col style="width:7%">
                                <col style="width:14%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:14%">
                                <col style="width:8%">
                                <col style="width:*">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col" rowspan="2">요금제</th>
                                <th scope="col" rowspan="2">월 기본요금</th>
                                <th colspan="3">공시지원금</th>
                                <th colspan="2">선택약정</th>
                                <th rowspan="2">부가서비스 정책</th>
                            </tr>
                            <tr>

                                <th scope="col">공시지원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                                <th scope="col">추가지원금</th>
                                <th scope="col">할부원금</th>
                            </tr>
                            </thead>
                            <tbody v-if="newSignUpList.length !== 0">
                            <tr v-for="list in newSignUpList">
                                <td class="alignC">{{list.pnMntRtNm}}</td>
                                <td>{{Number(list.pnMntAmt).toLocaleString()}}</td>
                                <td><input style="width: 100%" class="inMoney" type="text" v-model="list.pnOfclSubsd"
                                           placeholder="공시지원금">
                                </td>
                                <td>
                                    <input style="width: 100%" class="inMoney" type="text" v-model="list.pnExtSubsdDv"
                                           placeholder="공시 추가지원금">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnOfclSubsd -
                                    list.pnExtSubsdDv).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%" class="wPer inNumber" type="text"
                                           placeholder="선택약정 추가지원금" v-model="list.pnExtSubsdRt">
                                </td>
                                <td>
                                    {{Number(selectDevice.pnMsrp - list.pnExtSubsdRt).toLocaleString()}}
                                </td>
                                <td>
                                    <input style="width: 100%;" type="text" v-model="list.pnEtc">
                                </td>
                            </tr>
                            </tbody>
                            <tbody v-else>
                            <tr>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //content -->
                </div>
                <!-- //content group4 -->

            </div>
        </div>
    </div>
    <!-- //contents -->

</div>
</div>
<!-- //container -->
</div>
<!-- footer -->
<div id="footer">
    <div class="fixedWidth">
        copyrights WOORI BANK. all rights reserved.
        <div class="goTop"><a href="#" class="btnGoTop"><img th:src="@{/images/cmmn/btn-top.png}" alt="위로이동"></a></div>
    </div>
</div>
<!-- //footer -->

<div layout:fragment="script">
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                deviceCarr: "",
                carr: "",
                sellYn: [
                    {code: "all", value: "전체"},
                    {code: "y", value: "판매중"},
                    {code: "n", value: "미판매"}
                ],
                selectedSellOpt: "all",
                pnMkr: [
                    {code: "all", value: "전체"},
                    {code: "SAM", value: "삼성전자"},
                    {code: "APP", value: "애플"},
                    {code: "LGE", value: "LG전자"},
                    // {code: "XIA", value: "샤오미"},
                    {code: "ETC", value: "기타"}
                ],
                selectedMkr: "all",
                searchKey: "",
                networkType: [
                    {code: "all", value: "전체"},
                    {code: "5g", value: "5G"},
                    {code: "4g", value: "LTE"},
                    {code: "3g", value: "3G"}
                ],
                selectedNetType: "all",
                allchecked: false,
                checkedList: [],
                dpList: [],
                selectDevice: {},
                moveCarrList: [],
                chgDeviceList: [],
                newSignUpList: [],
            },
            mounted: function () {
                var currentPath = window.location.pathname
                this.carr = currentPath.substring(currentPath.lastIndexOf('/') + 1)
                switch (this.carr) {
                    case 'skt':
                        this.deviceCarr = 'S'
                        break
                    case 'kt':
                        this.deviceCarr = 'K'
                        break
                    case 'lgu':
                        this.deviceCarr = 'L'
                        break
                }

                this.searchList()
            },
            methods: {
                searchList() {
                    var param = {
                        mntCarr: this.carr,
                        deviceCarr: this.deviceCarr,
                        selectedNetType: this.selectedNetType,
                        pnMkr: this.selectedMkr,
                        searchKey: this.searchKey
                    }

                    cf_call("/carr/getSellDeviceList", param, this.searchListCB)
                },
                searchListCB(data) {
                    this.dpList = []

                    // this.sellDeviceList = data.sellDeviceList

                    switch (this.selectedSellOpt) {
                        case 'y' :
                            for (idx in data.sellDeviceList) {
                                if (data.sellDeviceList[idx].sellStatus) {
                                    this.dpList.push(data.sellDeviceList[idx])
                                }
                            }
                            break
                        case "n" :
                            for (idx in data.sellDeviceList) {
                                if (!data.sellDeviceList[idx].sellStatus) {
                                    this.dpList.push(data.sellDeviceList[idx])
                                }
                            }
                            break
                        default:
                            this.dpList = data.sellDeviceList
                            break
                    }
                    for (sell in this.dpList) {
                        this.dpList[sell].idx = sell

                        switch (this.dpList[sell].pnMkr) {
                            case 'SAM':
                                this.dpList[sell].pnMkr = '삼성전자'
                                break
                            case 'LGE':
                                this.dpList[sell].pnMkr = 'LG전자'
                                break
                            case 'APP':
                                this.dpList[sell].pnMkr = '애플'
                                break
                            case 'XIA':
                                this.dpList[sell].pnMkr = '샤오미'
                                break
                            case 'ETC':
                                this.dpList[sell].pnMkr = '기타'
                                break

                        }
                    }
                },
                getTrClass(idx) {
                    if (idx === this.selectDevice.idx) return true
                    else return false
                },
                checkAll() {
                    this.checkedList = []

                    if (this.allchecked) {
                        for (list in this.dpList) {
                            this.checkedList.push(this.dpList[list])
                        }
                    }
                },
                chkboxClick() {
                    this.allchecked = false
                    if (this.checkedList.length === this.dpList.length) {
                        this.allchecked = true
                    }
                },
                rowClick(data, idx) {
                    this.selectDevice = {}
                    this.selectDevice = data
                    this.selectDevice.idx = idx
                    var param = {
                        pnCarr: this.carr.toUpperCase(),
                        pnNetType: this.selectDevice.pnNetType,
                        pnStor: this.selectDevice.pnStor,
                        pnMdlNo: this.selectDevice.pnMdlNo
                    }
                    cf_call("/carr/getUseMntByDevice", param, this.rowClickCB)
                },
                rowClickCB(data) {
                    // console.log(data)
                    this.moveCarrList = []
                    this.chgDeviceList = []
                    this.newSignUpList = []
                    this.moveCarrList = data.moveCarrList
                    this.chgDeviceList = data.chgDeviceList
                    this.newSignUpList = data.newSignUpList
                },
                stopSale() {
                    let saleYn = false
                    for (idx in this.checkedList) {
                        // sellYn의 값이 없으면(미판매) true
                        if (!this.checkedList[idx].sellStatus) saleYn = true
                    }
                    if (saleYn) alert("선택하신 모델의 판매상태를 확인해주세요.")
                    else {
                        alert('판매중지')
                    }
                }
            }
        })
    </script>
</div>


</html>